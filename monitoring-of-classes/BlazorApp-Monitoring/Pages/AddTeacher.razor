@page "/addTeacher"
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components.Forms
@using BlazorDomain
@inject HttpClient Http

<PageTitle>Добавление преподавателя:</PageTitle>

<div id="allforms">
    <div id="edit_form">
        <div id="element">
            <EditForm Model="@teacherInfo">
                <p>
                    <b>Контактные данные</b>
                </p>
                <p>
                    Имя:<br />
                    <InputText id="name" @bind-Value="teacherInfo.Name" class="form-control" />
                </p>
                <p>
                    Фамилия:<br />
                    <InputText id="lastName" @bind-Value="teacherInfo.Surname" class="form-control" />
                </p>
                <p>
                    Номер телефона:<br />
                    <InputText id="phone" @bind-Value="teacherInfo.Phone" class="form-control" />
                </p>
                <button type="submit" class="btn btn-primary btn-sm" @onclick="submitTeacher">Добавить</button>
            </EditForm>
        </div>
    </div>
</div>

<div id="result">
    <!-- Результат добавления преподавателя -->
    <p style="color:black; margin-top: 3px; font-weight: 700;">@message</p>
</div>

@code {
    string message = "";

    async Task submitTeacher()
    {
        await PostASJson(teacherInfo);
    }

    protected async Task PostASJson(TeacherDTO teacher)
    {
        var response = await Http.PostAsJsonAsync("https://localhost:7145/api/Teacher/", teacher);
        if (response.IsSuccessStatusCode)
        {
            var newTeacher = await response.Content.ReadFromJsonAsync<TeacherDTO>();
            if (newTeacher != null) message = $"Учитель успешно добавлен. Его id = {newTeacher.Id}";
        }
        else
        {
            var error = await response.Content.ReadFromJsonAsync<Error>();
            if (error != null) message = error.Details;
        }
    }

    class Error
    {
        public string Details { get; set; } = "";
    }

    TeacherDTO teacherInfo = new TeacherDTO();
}
